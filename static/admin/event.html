<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Админ-панель</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" type="text/css" />
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <link href="css/personal.css" rel="stylesheet" />
        
    </head>
    <body>
      <nav class="navbar border-bottom border-body" >
        <ul class="nav nav-pills  mb-auto mx-auto justify-content-center" >
              
          <li class="nav-item">
            <a class="nav-link " href="/admin/">
              Все заявки
            </a>
          </li>
          <li>
            <a class="nav-link "  href="/admin/addEvent">
            
              Добавить ивент
            </a>
          </li>
          <li>
            <a class="nav-link active" href="/admin/event">
             
              Изменить цену
            </a>
          </li>
          
        </ul>
      </nav>
          <div class="container " >
                
            <form   class="row p-4"
              id="updatePrice"
              role="tabpanel">
              
                <div class=" mb-3">
                  <div class="row">
                    <div class="col-12"> <label for="">Ряд</label>
                      <input type="text" class="form-control" id="row-start" placeholder="С какого">
                      <br>
                      <input type="text" class="form-control" id="row-end" placeholder="По какой (Пустое если 1 ряд)"></div>
                      <div class="col-12">
                        <br>
                        <label for="">Место</label>
                        <input type="text" class="form-control" id="col-start" placeholder="С какого">
                        <br>
                        <input type="text" class="form-control" id="col-end" placeholder="По какое (Пустое если одно место)">
                      </div>
                    <div class="col-6">
                     <br>
                      <label for="sector">Сектор</label>
                      <select id="sector" class="form-control">
                        <option value="1" selected>Bronze</option>
                        <option value="2">Silver</option>
                        <option value="3">Gold</option>
                        <option value="4">Platinum</option>
                      </select>
                    </div>
                    <div class="col-6">
                      <br>
                      <label for="">Цена</label>
                      <input type="text" class="form-control" id="price" placeholder="1000">
                    </div>
                    <div class="col-12 mt-4">
                    <button type="submit"  class="w-100 btn btn-primary">Обновить цену</button>
                  </div>
                  </div>
                 
                </div>
                
              
               
            </form>
           
      </div>
               
   
        
       
       
      
      
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script>
          var array=[]
         
        $('svg path').mouseover(async function(e) {
          if(!$(this).attr("data-booked")){
            let position = $(this).offset()
            $('#hoverInfo').css("top", position.top-167).css('left', position.left-65)
            $('#hoverInfo').css("display", 'block')
            let secId
            switch (this.id.split('-')[0]) {
                case 'arena':
                  secId =  1
                  break;
                case 'silver':
                secId =  2
                  break;
                case 'gold':
                secId =  3
                  break;
                case 'platinum':
                secId =  4
                  break;
                default:
                  break;
              }
            var result = await array.find(obj => {
              return obj.col == this.id.split('-')[2] && obj.row ==this.id.split('-')[1] && obj.active==true && obj.sectorId==secId
            })
            if(result){
              let price='-'
              let status =''
              let  color="#1cda07"
              let spanColor='#000'
              let sector = ''
              switch (result.sectorId) {
                case 1:
                  sector =  'Bronze'
                  spanColor='#CD7F32'
                  break;
                case 2:
                  sector =  'Silver'
                  spanColor='#C0C0C0'
                  break;
                case 3:
                  sector =  'Gold'
                  spanColor='#DAA520'
                  break;
                case 4:
                  sector =  'Platinum'
                  spanColor='#E5E4E2'
                  break;
                default:
                  break;
              }
              switch (parseInt(result.statusId)) {
                case 1:
                status = 'Свободно'
                price=result.price
                  break;
                case 2:
                status = 'Ожидает рассмотрения'
                  break;
                case 3:
                status = 'Занято'
                  break;
                
                default:
                  break;
              }
          
              $('#priceText').text(price)
              $('#sectorText').text(sector).css('color', spanColor)
              $('#statusText').text(status)
              $('#statusText').css('color', color)
              $('#colText').text(result.col)
              $('#rowText').text(result.row)
          }
        }
          });
        fetch('/api/seat').then(async(res)=>{
            array=await res.json()
            for(let seat of array){
                let color="#d9d9d9"
                let sector=''
                switch (seat.sectorId) {
                case 1:
                  sector='arena'
                  color='#CD7F32'
                  break;
                case 2:
                  sector='silver'
                  color='#C0C0C0'
                  break;
                case 3:
                  sector='gold'
                color='#DAA520'
                  break;
                case 4:
                  sector='platinum'
                color='#E5E4E2'
                  break;
                default:
                  break;
              }
                if(seat.statusId==1){
                   
                    $('#'+sector+'-'+seat.row+'-'+seat.col).attr("fill", color )
                    
                }else{
                  
                    color="#da0707"
                   
                   await  $('#'+sector+'-'+seat.row+'-'+seat.col).attr("fill", color )
                   await  $('#'+sector+'-'+seat.row+'-'+seat.col).attr("data-booked",  true)
                   await  $('#'+sector+'-'+seat.row+'-'+seat.col).css("fill", color )
            
                }
               
            }
        })
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/admin-panel.js"></script>
    </body>
</html>
